<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #00b4db, #0083b0);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .search-box {
            margin-bottom: 2rem;
        }
        
        input {
            padding: 0.5rem 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 0.5rem;
            font-size: 1rem;
            width: 60%;
        }
        
        button {
            padding: 0.5rem 1rem;
            background: #0083b0;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        button:hover {
            background: #00b4db;
        }
        
        .weather-info {
            margin-top: 1rem;
        }
        
        .temp {
            font-size: 3rem;
            margin: 1rem 0;
        }
        
        .description {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        
        .details {
            display: flex;
            justify-content: space-around;
            margin-top: 2rem;
        }

        .loading {
            display: none;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="search-box">
            <input type="text" placeholder="Nhập tên thành phố..." id="city-input">
            <button onclick="getWeather()">Tìm kiếm</button>
        </div>
        <div class="loading" id="loading">Đang tải...</div>
        <div class="weather-info">
            <h2 id="city">--</h2>
            <div class="temp" id="temp">--°C</div>
            <div class="description" id="description">--</div>
            <div class="details">
                <div>
                    <p>Độ ẩm</p>
                    <p id="humidity">--%</p>
                </div>
                <div>
                    <p>Gió</p>
                    <p id="wind">-- km/h</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function getWeather() {
            const cityInput = document.getElementById('city-input').value;
            if (!cityInput) return;

            document.getElementById('loading').style.display = 'block';

            try {
                // First, get coordinates for the city
                const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cityInput)}&count=1&language=vi`;
                const geoResponse = await fetch(geoUrl);
                const geoData = await geoResponse.json();

                if (!geoData.results || geoData.results.length === 0) {
                    throw new Error('Không tìm thấy thành phố');
                }

                const { latitude, longitude, name } = geoData.results[0];

                // Then, get weather data using coordinates
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code`;
                const weatherResponse = await fetch(weatherUrl);
                const weatherData = await weatherResponse.json();

                // Weather code to description mapping
                const weatherDescriptions = {
                    0: 'Trời quang',
                    1: 'Ít mây',
                    2: 'Nhiều mây',
                    3: 'U ám',
                    45: 'Sương mù',
                    48: 'Sương mù đọng băng',
                    51: 'Mưa phùn nhẹ',
                    53: 'Mưa phùn',
                    55: 'Mưa phùn nặng',
                    61: 'Mưa nhẹ',
                    63: 'Mưa',
                    65: 'Mưa nặng',
                    71: 'Tuyết nhẹ',
                    73: 'Tuyết',
                    75: 'Tuyết nặng',
                    95: 'Giông bão'
                };

                document.getElementById('city').textContent = name;
                document.getElementById('temp').textContent = `${Math.round(weatherData.current.temperature_2m)}°C`;
                document.getElementById('description').textContent = weatherDescriptions[weatherData.current.weather_code] || 'Không xác định';
                document.getElementById('humidity').textContent = `${Math.round(weatherData.current.relative_humidity_2m)}%`;
                document.getElementById('wind').textContent = `${Math.round(weatherData.current.wind_speed_10m)} km/h`;
            } catch (error) {
                alert('Không tìm thấy thành phố hoặc có lỗi xảy ra. Vui lòng thử lại!');
                console.error('Error:', error);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Thêm sự kiện Enter cho input
        document.getElementById('city-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getWeather();
            }
        });
    </script>
</body>
</html>
